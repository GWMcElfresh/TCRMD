Bootstrap: docker
From: mambaorg/micromamba:1.5.8

%labels
    Maintainer TCRMD
    Stage simulate
    Description "OpenMM energy minimisation and NVT/NPT equilibration (AMBER14SB, TIP3P-FB)"

%files
    envs/simulate.yaml /tmp/env.yaml
    tcrmd/ /app/tcrmd/
    tests/  /app/tests/
    pyproject.toml /app/pyproject.toml

%post
    micromamba install -y -n base -f /tmp/env.yaml && \
    micromamba clean --all --yes

%environment
    export PATH="/opt/conda/bin:$PATH"
    export MAMBA_ROOT_PREFIX="/opt/conda"

%runscript
    exec python "$@"

%test
    python -m pytest /app/tests/test_simulate.py -v --tb=short
